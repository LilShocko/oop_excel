# Приложение за работа с електронни таблици

## Представяне на данните

Данните на една таблица ще записваме в текстов файл по следния начин:

1.  Всеки ред във файла представя отделен ред в таблицата.
2.  Всеки ред във файла съдържа данни разделени със запетаи. Тези данни се интерпретират като стойностите в клетките на реда.
3.  Всеки ред в таблицата може да съдържа различен брой клетки. Затова и всеки ред във файла може да съдържа различен брой елементи разделени със запетаи.
4.  Празен ред във файла представя празен ред в таблицата. (т.е. ред, в който всички клетки са празни).
5.  Между две запетаи във файла може да няма никакви данни. По този начин се представя празна клетка.
6.  Между данните и запетаите може да има произволен брой празни символи (whitespace).

Така за една таблица може да има различни представяния. Например таблицата:

| 10 | 20 | 30   | 40 |
|----|----|------|----|
|    |    |      |    |
| 10 |    | 1000 |    |
|    |    |      |    |
|    | 10 |      |    |

може да се представи по следните начини (възможни са и други представяния):

| 10, 20, 30, 40  10,,1000, ,,, ,10 | 10, 20 , 30 , 40  10, , 1000,  , , ,  , 10 |
|-----------------------------------|--------------------------------------------|

## Типове данни в таблицата

Всяка клетка в таблицата има тип, като в една таблица може да има едновременно клетки от различни типове. Вашето приложение трябва да може да поддържа следните типове:

**Цяло число** – поредица от цифри, без никакви други символи между тях. В началото на числото може да има знак '+' или '-'. Например:

123

\-123

\+123

**Дробно число** – поредица от цифри, следвана от символ за точка и след нея друга поредица от цифри. В началото на числото може да има знак '+' или '-'l. Например:

123.456

\-123.456

\+123.456

**Символен низ (стринг)** – поредица от произволни символи оградени в кавички. Подобно на низовете в C++, ако искате да включите символа за кавичка в даден низ, трябва да го представите като \\", а ако искате да включите наклонена черта, трябва да я представите като \\\\. Например:

"Hello world!"

"C:\\\\temp\\\\"

"\\"This is a quotation\\""

**Формула** – формулата винаги започва със символ за равенство. В нея могат да участват следните операции: събиране (+), изваждане (-), умножение (\*), деление (/) и степенуване (\^). Във формулата могат да участват или числа или препратки към клетки в таблицата. Ако във формулата участва препратка към клетка, на това място в изчислението трябва да се използва стойността съхранена в дадената клетка. Повече информация за формулите е дадена по-долу.

## Нужна функционалност

След като приложението отвори даден файл, то трябва да може да извършва посочените по-долу операции, в допълнение на общите операции (open, close, save, save as, help и exit):

| print | Извежда съдържанието на таблицата на екрана                                                                                                                                                                                                      |
|-------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| edit  | Редактира съдържанието на дадена клетка. За целта потребителят въвежда текст, който ще бъде новото съдържание на клетката.  Забележете, че по този начин може да се промени типът на дадена клетка, например от число, тя може да стане формула. |

Както беше казано в общата за всички проекти информация, ако при зареждането на данните, приложението ви открие грешка, то трябва да изведе подходящо съобщение за грешка и да прекрати своето изпълнение. Съобщението трябва да подскаже на потребителя какво не е наред във входните данни. Например:

-   Ако липсва запетая трябва да се изведе на кой ред и след кой символ липсва запетаята;
-   Ако съдържанието на дадена клетка е от неизвестен тип, трябва да се изведе на кой ред и коя колона е клетката и какво точно е некоректното съдържание. Например нека предположим, че на ред 2, колона 5, потребителят е въвел 123.123.123. Приложението ви може да изведе например следното съобщение: *“Error: row 2, col 5, 123.123.123 is unknown data type”*.

## Извеждане на таблицата на екрана

При извеждане на заредената таблица (командата print), данните в колоните трябва да се подравнят. Между отделните колони трябва да се поставят символи за отвесна черта (\|). По-долу е даден пример за входен файл и възможно негово извеждане:

| Входен файл                                          | Извеждане                                                                   |
|------------------------------------------------------|-----------------------------------------------------------------------------|
| 10, "Hello world!", 123.56 "\\"Quoted\\"" 1, 2, 3, 4 | 10 \| Hello world! \| 123.56 \| \| "Quoted" \| \| \| \| 1 \| 2 \| 3 \| 4 \| |

## Редактиране на клетки

Командата Edit трябва да позволява (с подходящи параметри) на потребителя да променя стойностите на отделните клетки. Това става като се укажат реда и колоната на клетката, която искаме да променим, а също и каква стойност да запише в нея. Потребителят може да въведе произволен тип данни, който се поддържа от вашата програма (например цяло число, дробно число, низ, формула и т.н.).

Ако потребителят въведе неправилни данни, приложението ви не трябва да променя нищо в таблицата, а само да изведе на екрана съобщение, че са въведени неправилни данни. В този случай приложението ви НЕ трябва да прекратява своето изпълнение.

## Формули

Номерата на редовете и клетките в таблицата започват от 1. Препратка към ред \<N\> и колона \<M\> в таблицата се записва така: R\<N\>C\<M\>. Например клетката в ред 10 и колона 5 се представя като R10C5.

В дадена формула могат да участват единствено:

1.  Литерали: цели или дробни числа.
2.  Препратки към произволни типове клетки.

При сметките важат следните правила:

1.  Ако в дадена формула участват само числа, то сметката се извършва по традиционните правила на аритметиката. Като специален случай можем да отделим делението на две цели числа. В такъв случай не бива да губите остатъка и резултатът трябва да бъде дробно число (например 1 делено на 2 дава резултат 0,5).
2.  Ако в дадена формула участва низ, той трябва да се конвертира до число. Това става по следния начин: Ако низът съдържа само цифри или поредица от цифри, символ точка и друга поредица от цифри, той се конвертира до съответното число. Всички други низове се конвертират до нула. Например:

| Низ           | Конвертирана стойност |
|---------------|-----------------------|
| “123”         | 123                   |
| “123.456.789” | 0                     |
| “123.456”     | 123.456               |
| “Hello world” | 0                     |
| “123abc”      | 0                     |

1.  Ако в дадена формула участва празна клетка, тя се конвертира до нула. Това важи и за клетки, чиито координати надхвърлят размерите на таблицата.
2.  Ако в дадена формула има грешка (например деление на нула), приложението ви не трябва да прекъсва своето изпълнение. Вместо това, когато то извежда таблицата на екрана, в съответната клетка се извежда ERROR, вместо получен резултат.

По-долу е дадена примерна таблица. В нея клетките в жълт цвят са от тип число. Клетките в зелено са от тип символен низ:

|           | **Колона 1** | **Колона 2** | **Колона 3** |
|-----------|--------------|--------------|--------------|
| **Ред 1** | 10           | Hello world! | 123.56       |
| **Ред 2** | 123          |              |              |

По-долу са дадени формули, които се оценяват в примерната таблица по-горе. За всяка формула е дадена и нейната оценка:

| **Формула в клетката** | **Реално извършена сметка** | **Стойност на клетката** | **Коментар**                                                                                                                                                          |
|------------------------|-----------------------------|--------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| = 10 + 10              | 10 + 10                     | 20                       |                                                                                                                                                                       |
| = R1C1 + R1C3          | 10 + 123.56                 | 133.56                   |                                                                                                                                                                       |
| = R1C1 \* R1C2         | 10 \* 0                     | 0                        | Низът „Hello world!“ се конвертира до нула                                                                                                                            |
| = R1C1 \* R2C1         | 10 \* 123                   | 1230                     | Низът „123“ се конвертира до 123 Клетката на ред 2, колона 2 е празна В таблицата няма ред 200 и колона 200. Считаме, че тя е празна.    т „123“ се конвертира до 123 |
| = R1C1 \* R2C2         | 10 \* 0                     | 0                        | Клетката на ред 2, колона 2 е празна                                                                                                                                  |
| = R1C1 \* R200C1       | 10 \* 0                     | 0                        | В таблицата няма ред 200 и колона 200. Считаме, че тя е празна.                                                                                                       |
| = 10 / 0               | 10 / 0                      | ERROR                    |                                                                                                                                                                       |
| = 10 / R1C2            | 10 / 0                      | ERROR                    |                                                                                                                                                                       |
| = R1C1 / R1C2          | 10 / 0                      | ERROR                    |                                                                                                                                                                       |
